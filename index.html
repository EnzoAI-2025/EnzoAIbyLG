<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enzo.AI ‚Äî Agente de Busca</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1220;
      --card: #141b2e;
      --muted: #94a3b8;
      --glass: rgba(255, 255, 255, 0.05);
      --grad-start: #00d9ff;
      --grad-end: #a855f7;
      --grad: linear-gradient(45deg, var(--grad-start), var(--grad-end));
      --text-color: #e6eef6;
      --shadow-color: rgba(168, 85, 247, 0.4);
    }
    *{box-sizing:border-box;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{
      margin:0;background:linear-gradient(180deg,var(--bg) 0%,#041421 100%);
      color:var(--text-color);min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:24px;transition:background .3s ease,color .3s ease;
    }
    body.light{background:linear-gradient(180deg,#f0f4f8 0%,#d9e2ec 100%);color:#1e293b;--card:#fff;--glass:rgba(0,0,0,0.05);--muted:#475569;}
    .app{width:100%;max-width:940px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6);backdrop-filter:blur(5px);}
    header{display:flex;gap:12px;align-items:center}
    .logo{width:80px;height:80px;border-radius:12px;display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:22px;color:#fff;letter-spacing:-1px;text-shadow:0 0 12px var(--shadow-color);
      box-shadow:0 0 15px rgba(16,185,129,0.15);overflow:hidden;background:var(--grad);}
    h1{margin:0;font-size:20px}
    p.lead{margin:4px 0 12px;color:var(--muted);font-size:13px}
    .chat{background:var(--card);border-radius:12px;padding:14px;min-height:320px;max-height:60vh;overflow-y:auto;display:flex;flex-direction:column;}
    .msg{padding:10px 12px;margin-bottom:8px;border-radius:10px;max-width:78%;line-height:1.5;}
    .user{background:var(--glass);border:1px solid rgba(255,255,255,0.08);margin-left:auto;border-top-right-radius:2px;}
    .bot{background:var(--card);border:1px solid var(--shadow-color);box-shadow:0 0 10px var(--shadow-color);border-top-left-radius:2px;}
    .meta{font-size:11px;color:var(--muted);margin-bottom:6px}
    .result-source{font-size:11px;color:var(--grad-start);margin-top:6px;opacity:0.8;display:block;}
    .controls{display:flex;gap:8px;margin-top:12px}
    input[type=text]{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);
      background:transparent;color:inherit;transition:border-color .2s ease;}
    input[type=text]:focus{outline:none;border-color:var(--grad-end);}
    button{padding:10px 14px;border-radius:10px;border:0;background:var(--grad-end);color:#072018;font-weight:600;
      cursor:pointer;transition:opacity .2s ease,transform .1s ease;}
    button:hover{opacity:0.9;transform:translateY(-1px);}
    .suggestions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .chip{background:rgba(255,255,255,0.05);padding:6px 10px;border-radius:999px;cursor:pointer;
      border:1px solid rgba(255,255,255,0.02);font-size:13px;transition:background .2s ease;}
    .chip:hover{background:rgba(255,255,255,0.1);}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .small{font-size:12px;color:var(--muted)}
    .actions button{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted);
      padding:6px 10px;border-radius:8px;}
    .actions button:hover{background:rgba(255,255,255,0.05);}
    .typing{display:flex;gap:4px;align-items:center;height:12px;}
    .typing span{display:block;width:6px;height:6px;background:var(--grad-start);border-radius:50%;
      animation:pulse 1.4s infinite ease-in-out both;}
    .typing span:nth-child(1){animation-delay:-0.32s;}
    .typing span:nth-child(2){animation-delay:-0.16s;}
    .typing span:nth-child(3){animation-delay:0s;}
    @keyframes pulse{0%,80%,100%{transform:scale(0);opacity:0.5;}40%{transform:scale(1);opacity:1;}}
  </style>
</head>
<body>
  <main class="app">
    <header>
      <div class="logo">E.IA</div>
      <div style="flex:1">
        <h1>Enzo.AI ‚Äî Agente de Busca</h1>
        <p class="lead">Pesquisador avan√ßado na web com resultados instant√¢neos.</p>
      </div>
      <button id="theme">Tema</button>
    </header>

    <section class="chat" id="chat"></section>

    <div class="suggestions" id="sugs">
      <div class="chip">O que √© a Torre Eiffel?</div>
      <div class="chip">Qual a cota√ß√£o do d√≥lar hoje?</div>
      <div class="chip">O que significa "Machine Learning"?</div>
      <div class="chip">Pr√≥xima partida do meu time</div>
    </div>

    <div class="controls">
      <input id="input" type="text" placeholder="Digite o que voc√™ quer pesquisar..." />
      <button id="send">Pesquisar</button>
      <button id="export">Exportar</button>
    </div>

    <footer>
      <div class="small">Enzo.AI ‚Äî Powered by SerpAPI (via Proxy Local)</div>
      <div class="actions"><button id="clear">Limpar</button></div>
    </footer>
  </main>

  <script>
    const chatEl = document.getElementById("chat");
    const input = document.getElementById("input");
    const send = document.getElementById("send");
    const clearBtn = document.getElementById("clear");
    const exportBtn = document.getElementById("export");
    const themeBtn = document.getElementById("theme");
    const sugsEl = document.getElementById("sugs");

    function escapeHtml(t){return t.replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m]));}
    function appendMessage(text,who="bot",source=""){
      const msg=document.createElement("div");
      msg.className="msg "+(who==="user"?"user":"bot");
      let bodyContent=escapeHtml(text);
      if(who==="bot"&&source){bodyContent+=`<a href="${source.link}" target="_blank" class="result-source">Fonte: ${source.title||source.link}</a>`;}
      msg.innerHTML=`<div class="meta">${who==="user"?"Voc√™":"Enzo.AI"}</div><div class="body">${bodyContent}</div>`;
      chatEl.appendChild(msg);chatEl.scrollTop=chatEl.scrollHeight;
    }

    async function serpSearch(q){
      const res=await fetch("http://localhost:3000/search",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({q})
      });
      const data=await res.json();
      let reply={text:"N√£o encontrei um resultado relevante.",source:null};
      if(data.knowledge_graph){
        reply.text=data.knowledge_graph.description||data.knowledge_graph.title;
        reply.source={title:data.knowledge_graph.source?.title||"Painel Google",link:data.knowledge_graph.source?.link||"https://google.com"};
      }else if(data.answer_box?.snippet){
        reply.text=data.answer_box.snippet;
        reply.source={title:data.answer_box.source?.title||"Resposta em Destaque",link:data.answer_box.source?.link||data.answer_box.link};
      }else if(data.organic_results?.length>0){
        const r=data.organic_results[0];
        reply.text=`Encontrei isto: ${r.snippet}`;reply.source={title:r.title,link:r.link};
      }
      return reply;
    }

    async function handleUserMessage(txt){
      input.value="";
      if(!txt.trim())return appendMessage("Digite algo para pesquisar üßê","bot");
      appendMessage(txt,"user");
      const typing=showTyping();
      try{
        const result=await serpSearch(txt);
        typing.remove();appendMessage(result.text,"bot",result.source);
      }catch(e){
        typing.remove();appendMessage("Erro ao buscar: "+e.message,"bot");
      }
    }

    function showTyping(){
      const el=document.createElement("div");
      el.className="msg bot";
      el.innerHTML='<div class="meta">Enzo.AI</div><div class="body"><div class="typing"><span></span><span></span><span></span></div></div>';
      chatEl.appendChild(el);chatEl.scrollTop=chatEl.scrollHeight;return el;
    }

    send.onclick=()=>{if(!input.value.trim())return;handleUserMessage(input.value.trim());};
    input.onkeydown=e=>{if(e.key==="Enter")send.click();};
    clearBtn.onclick=()=>{chatEl.innerHTML="";appendMessage("Hist√≥rico limpo! üîç","bot");};
    themeBtn.onclick=()=>{document.body.classList.toggle("light");themeBtn.textContent=document.body.classList.contains("light")?"Escuro":"Tema";};
    sugsEl.querySelectorAll(".chip").forEach(chip=>{chip.onclick=()=>{input.value=chip.textContent;send.click();};});
    exportBtn.onclick=()=>{
      const text=[...chatEl.querySelectorAll(".msg")].map(m=>m.innerText).join("\n\n");
      const blob=new Blob([text],{type:"text/plain"});
      const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="conversa_enzoai.txt";a.click();
    };

    appendMessage("Ol√° üëã Eu sou o Enzo.AI, seu agente de busca! Pergunte algo e eu encontro pra voc√™. üîé","bot");
  </script>
</body>
</html>
